# Configuration version - DO NOT MODIFY
# Used internally to detect when new config options are available
config-version: 4

# AMSSync Plugin Configuration
#
# IMPORTANT: Add this file to .gitignore to protect your bot token!
#
# SECRETS: Discord token and guild ID can be set via environment variables:
#   - AMS_DISCORD_TOKEN: Bot token (takes precedence over config file)
#   - AMS_GUILD_ID: Guild ID (takes precedence over config file)

# ============================================================================
# CORE DISCORD SETTINGS
# ============================================================================
discord:
  # Your Discord bot token from https://discord.com/developers/applications
  token: "YOUR_BOT_TOKEN_HERE"

  # Your Discord server (guild) ID for slash command registration
  # Right-click your server icon -> Copy ID (requires Developer Mode enabled)
  guild-id: "YOUR_GUILD_ID_HERE"

  # Retry configuration for Discord connection failures
  # Implements exponential backoff to handle transient network issues
  retry:
    # Enable/disable retry logic (true = retry on failure, false = fail immediately)
    enabled: true

    # Maximum number of connection attempts (including initial attempt)
    max-attempts: 5

    # Initial delay in seconds before first retry attempt
    initial-delay-seconds: 5

    # Maximum delay in seconds between retry attempts (caps exponential backoff)
    max-delay-seconds: 300

    # Exponential backoff multiplier (delay doubles with default 2.0)
    # Example delays with defaults: 5s, 10s, 20s, 40s, 80s
    backoff-multiplier: 2.0

  # Timeout protection for Discord operations
  # Prevents hanging operations from blocking the plugin
  timeout:
    # Enable/disable timeout protection (true = operations have timeout limits)
    enabled: true

    # Warning threshold in seconds - logs warning if operation takes longer
    # Helps identify slow operations before they timeout
    warning-threshold-seconds: 3

    # Hard timeout in seconds - operation is cancelled if it exceeds this
    # Prevents indefinite blocking of plugin operations
    # Discord initialization and API calls will abort after this duration
    hard-timeout-seconds: 10

  # Circuit breaker pattern for Discord API calls
  # Prevents cascading failures by failing fast when Discord is down
  circuit-breaker:
    # Enable/disable circuit breaker (true = automatic failure protection)
    enabled: true

    # Number of failures before opening circuit (failing fast)
    # Example: 5 failures = circuit opens and all requests fail immediately
    failure-threshold: 5

    # Time window in seconds for counting failures
    # Failures outside this window are not counted toward threshold
    # Example: 5 failures in 60 seconds = circuit opens
    time-window-seconds: 60

    # Cooldown period in seconds before attempting recovery
    # When circuit is open, wait this long before testing if service recovered
    # Example: After 30 seconds, circuit enters HALF_OPEN state to test recovery
    cooldown-seconds: 30

    # Number of consecutive successes needed to close circuit
    # In HALF_OPEN state, this many successes are needed to fully recover
    # Example: 2 successful calls = circuit closes and normal operation resumes
    success-threshold: 2

# ============================================================================
# MCMMO INTEGRATION
# ============================================================================
mcmmo:
  leaderboard:
    # Maximum number of players to scan when generating leaderboards
    # Prevents timeout issues on servers with many players (1000+ recommended)
    # Lower value = faster queries but may miss some players
    # Higher value = more complete but slower queries
    max-players-to-scan: 1000

    # Cache time-to-live in seconds for leaderboard results
    # Cached leaderboards are reused for this duration to improve performance
    # Set to 0 to disable caching (not recommended)
    # Recommended: 60 seconds (provides ~60x performance improvement)
    cache-ttl-seconds: 60

# ============================================================================
# RATE LIMITING (Applied to all commands)
# ============================================================================
rate-limiting:
  # Enable/disable rate limiting
  enabled: true

  # Cooldown applied after exceeding the rate limit (milliseconds)
  # Users can make requests freely until they hit the limit, then must wait
  # Example: 10000 = 10 second penalty after exceeding rate limit
  penalty-cooldown-ms: 10000

  # Maximum requests per minute per user (burst protection)
  # Example: 60 = max 60 commands per minute
  max-requests-per-minute: 60

# ============================================================================
# WHITELIST MANAGEMENT
# Allows Discord admins to add/remove players from the server whitelist
# ============================================================================
whitelist:
  # Enable/disable the /amswhitelist Discord command
  # When disabled, the command will not be registered with Discord
  enabled: true

# ============================================================================
# FEATURE: IMAGE CARDS
# Generates visual player cards and podium leaderboards as images
# Used by /amsstats and /amstop commands
# ============================================================================
image-cards:
  # Enable/disable image card generation
  # When disabled, /amsstats and /amstop will show a message to use text commands instead
  enabled: true

  # Server name shown in card footer
  server-name: "Minecraft Server"

  # Avatar/skin provider for player images
  # Options: "mc-heads" or "crafatar"
  # mc-heads: Uses player name (faster, no UUID needed)
  # crafatar: Uses player UUID (more accurate for name changes)
  avatar-provider: "mc-heads"

  # Avatar cache settings
  avatar-cache:
    # Cache time-to-live in seconds
    # Caches downloaded player avatars to reduce API calls
    ttl-seconds: 300

    # Maximum number of cached avatars
    max-size: 100

# ============================================================================
# FEATURE: EVENT ANNOUNCEMENTS
# Posts Minecraft events to Discord channels (MCMMO milestones, deaths, etc.)
# ============================================================================
event-announcements:
  # Master enable/disable for all event announcements
  # When false, no events will be posted to Discord regardless of sub-feature settings
  enabled: false

  # MCMMO milestone announcements
  # Posts when players reach skill/power level milestones
  mcmmo-milestones:
    # Enable/disable milestone announcements
    enabled: false

    # Text channel ID for announcements (right-click channel -> Copy ID)
    channel-id: ""

    # Announce when a skill reaches a multiple of this level (0 = disabled)
    # Example: 100 = announce at level 100, 200, 300, etc.
    skill-milestone-interval: 100

    # Announce when power level reaches a multiple of this level (0 = disabled)
    # Example: 500 = announce at power level 500, 1000, 1500, etc.
    power-milestone-interval: 500

    # Generate visual image cards for milestone announcements
    # When true, sends attractive celebration cards with skill badges and player avatars
    # When false, uses standard embeds or plain text
    use-image-cards: true

    # Use rich embeds (true) or plain text (false)
    # Note: Ignored when use-image-cards is true
    use-embeds: true

    # Show player Minecraft avatars in milestone cards/embeds
    show-avatars: true

    # Avatar provider: "mc-heads" or "crafatar"
    avatar-provider: "mc-heads"

  # Server lifecycle events (start/stop)
  # Announces server start and stop to Discord
  server-events:
    # Enable/disable server event announcements
    enabled: false

    # Text channel ID for event announcements (right-click channel -> Copy ID)
    channel-id: ""

    # Server start announcement
    start:
      enabled: true
      message: "Server is now online!"

    # Server stop announcement
    stop:
      enabled: true
      message: "Server is shutting down..."

  # Player death announcements
  # Posts player death messages to Discord
  player-deaths:
    # Enable/disable death announcements
    enabled: false

    # Text channel ID for death announcements (right-click channel -> Copy ID)
    channel-id: ""

    # Funny commentary added after death messages
    # Example: "PlayerX fell from a high place" + "Gravity always wins."
    commentary:
      # Enable/disable funny commentary after death messages
      enabled: true

      # Enable extra roasts for high-level MCMMO players dying to embarrassing causes
      # (starvation, cactus, drowning, berry bush, bee, slime, etc.)
      # Example: Level 5000 player drowns â†’ "Elite player, amateur swimmer."
      mcmmo-roasts: true

      # Minimum MCMMO power level for elite roasts
      # Players below this threshold won't get the extra roast messages
      mcmmo-roast-threshold: 3000

  # Achievement/advancement announcements
  # Posts player achievements to Discord
  achievements:
    # Enable/disable achievement announcements
    enabled: false

    # Text channel ID for achievement announcements (right-click channel -> Copy ID)
    channel-id: ""

    # Exclude recipe unlock advancements (only show real achievements)
    exclude-recipes: true

  # Webhook configuration (shared across all event types)
  # Optional webhook URL for prettier messages with custom avatars
  # Leave empty to use standard bot messages
  # Create a webhook: Channel Settings -> Integrations -> Webhooks -> New Webhook
  webhook:
    url: ""
    # Use rich embeds (true) or plain text (false)
    use-embeds: true
    # Show player Minecraft avatars in embeds/webhook messages
    show-avatars: true
    # Avatar provider: "mc-heads" or "crafatar"
    avatar-provider: "mc-heads"

# ============================================================================
# FEATURE: CHAT BRIDGE
# Two-way chat relay between Minecraft and Discord
# ============================================================================
chat-bridge:
  # Enable/disable chat bridge
  enabled: false

  # Text channel ID for chat relay (right-click channel -> Copy ID)
  channel-id: ""

  # Relay Minecraft chat to Discord
  minecraft-to-discord: true

  # Relay Discord chat to Minecraft
  discord-to-minecraft: true

  # Format for Discord messages shown in Minecraft
  # Available placeholders: {author} = Discord username, {message} = message content
  # Supports color codes with &
  mc-format: "&7[Discord] &b{author}&7: {message}"

  # Format for Minecraft messages shown in Discord
  # Available placeholders: {player} = Minecraft username, {message} = message content
  # Supports Discord markdown (**bold**, *italic*, etc.)
  # NOTE: When use-webhook is true, discord-format is ignored - messages show
  # directly with player name and avatar
  discord-format: "**{player}**: {message}"

  # Message prefixes to ignore (e.g., don't relay commands)
  ignore-prefixes:
    - "/"

  # Suppress Discord notifications for bridged messages
  # When true, messages from Minecraft won't trigger Discord push notifications
  # Users will still see messages but won't get pinged
  # NOTE: Only applies when use-webhook is false
  suppress-notifications: true

  # Use webhook for richer Discord messages
  # When true, Minecraft messages appear with player's head as avatar and username
  # When false, messages appear as bot messages with discord-format template
  use-webhook: false

  # Optional webhook URL for chat bridge
  # Leave empty to use standard bot messages (use-webhook must be true for this to work)
  # Create a webhook: Channel Settings -> Integrations -> Webhooks -> New Webhook
  webhook-url: ""

  # Avatar provider for player heads in webhook messages
  # Options: "mc-heads" or "crafatar"
  avatar-provider: "mc-heads"

  # Convert @username mentions to Discord mentions for linked users
  # When a Minecraft player types @Username, if that user has linked their
  # Discord account via /amssync, the message will ping them on Discord
  # Users not linked will appear as plain @username text (no notification)
  resolve-mentions: true

# ============================================================================
# FEATURE: PLAYER COUNT DISPLAY
# Shows current player count in Discord bot status and/or voice channel name
# ============================================================================
player-count-display:
  # Bot Activity/Status display
  # Shows in Discord under the bot's name (e.g., "Playing 12 players online")
  bot-presence:
    # Enable/disable bot activity updates
    enabled: true

    # Minimum seconds between Discord API updates
    # Discord rate limits presence updates to ~5/minute
    # Recommended: 30-60 seconds to stay well under limits
    min-update-interval-seconds: 30

    # Debounce delay in seconds
    # Waits this long after player join/quit before updating
    # Helps batch rapid changes (e.g., server restart, mass teleport)
    debounce-seconds: 5

    # Activity configuration
    activity:
      # Enable/disable activity updates
      enabled: true

      # Activity type: playing, watching, listening, competing
      type: "playing"

      # Message template
      # Available placeholders: {count} = current player count, {max} = max players
      template: "{count} players online"

    # Bot Nickname display (per-guild)
    # Changes the bot's nickname in your Discord server
    # IMPORTANT: Bot needs CHANGE_NICKNAME permission in your server
    nickname:
      # Enable/disable nickname updates (disabled by default - requires permission)
      enabled: false

      # Nickname template
      # Available placeholders: {count} = player count, {name} = original bot name, {max} = max players
      template: "[{count}] {name}"

      # If true, logs warning and continues if nickname change fails
      # If false, disables nickname updates after first failure
      graceful-fallback: true

  # Voice channel showing player count
  # Updates the channel name to show current player count (e.g., "5 AMS Online")
  # NOTE: Discord limits channel renames to 2 per 10 minutes, so updates are batched
  status-channel:
    # Enable/disable status channel updates
    enabled: false

    # Voice channel ID to update (right-click channel -> Copy ID)
    channel-id: ""

    # Channel name template
    # Available placeholders: {count} = current player count, {max} = max players
    template: "{count} AMS Online"

    # Minimum seconds between channel name updates
    # Discord rate limit is 2 updates per 10 minutes - recommend 300+ seconds
    update-interval-seconds: 300

# ============================================================================
# FEATURE: PROGRESSION TRACKING
# Records level-up events and periodic snapshots for analytics and graphs
# Data is stored in a SQLite database (uses Paper's bundled SQLite JDBC)
# ============================================================================
progression-tracking:
  # Master enable/disable for all progression tracking features
  # When disabled, no data is collected or stored
  enabled: false

  # SQLite database filename (relative to plugin data folder)
  # The database file is created automatically when first enabled
  database-file: "progression.db"

  # Level-up event tracking
  # Records each skill level-up with timestamp, skill, old/new level
  events:
    # Enable/disable level-up event recording
    enabled: true

  # Periodic skill snapshots
  # Captures full skill state for all online players at regular intervals
  # Useful for tracking progression velocity and time-based analytics
  snapshots:
    # Enable/disable periodic snapshots
    enabled: true

    # Interval between snapshots in minutes
    # Lower = more granular data but larger database
    # Recommended: 5-15 minutes
    interval-minutes: 5

    # Only snapshot online players (recommended)
    # When true, only captures players currently on the server
    online-only: true

  # Tiered data retention and compaction
  # Implements logarithmic retention: raw -> hourly -> daily -> weekly -> delete
  # This balances storage efficiency with historical data availability
  retention:
    # Enable/disable automatic data cleanup and compaction
    enabled: true

    # How often to run the cleanup/compaction task (in hours)
    # Runs asynchronously to avoid blocking server
    cleanup-interval-hours: 24

    # Tiered retention periods
    # Data flows: raw snapshots -> hourly -> daily -> weekly -> deleted
    tiers:
      # Keep raw snapshots (every N minutes) for this many days
      # After this, snapshots are compacted into hourly summaries
      # Example: 7 = keep 5-minute snapshots for 1 week
      raw-days: 7

      # Keep hourly summaries for this many days
      # After this, hourly data is compacted into daily summaries
      # Example: 30 = keep hourly data for 1 month
      hourly-days: 30

      # Keep daily summaries for this many days
      # After this, daily data is compacted into weekly summaries
      # Example: 180 = keep daily data for 6 months
      daily-days: 180

      # Keep weekly summaries for this many years
      # After this, weekly data is permanently deleted
      # Example: 5 = keep weekly data for 5 years
      weekly-years: 5

# ============================================================================
# USER MAPPINGS (Discord ID <-> Minecraft Username)
# ============================================================================
# Format: "discord_user_id": "MinecraftUsername"
#
# IMPORTANT: Use Minecraft USERNAMES (not UUIDs) as values!
# You can find Discord IDs by right-clicking a user in Discord -> Copy ID (Developer Mode required)
#
# Example:
#   user-mappings:
#     "123456789012345678": "Steve"
#     "987654321098765432": "Alex"
#
# Use /amslink command in-game or Discord to add mappings
user-mappings: {}
